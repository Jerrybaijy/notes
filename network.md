---
title: network
author: Jerry.Baijy
tags:
  - 应用科学
  - it
  - it-basics
  - web
---

# TCP/IP 四层模型

TCP/IP 模型是现代互联网通信的基础。它将复杂的网络通信过程划分为四个逻辑层，每一层都负责特定的功能，并为其上一层提供服务。

| **层级** | **名称**                        | **主要功能**                                                 | **常见协议**              |
| :------: | ------------------------------- | ------------------------------------------------------------ | ------------------------- |
|  **4**   | **应用层 (Application)**        | 直接为用户的应用程序提供服务，规定数据传输的格式。           | HTTP, FTP, DNS, SMTP, SSH |
|  **3**   | **传输层 (Transport)**          | 负责端到端（进程到进程）的通信，确保数据传输的可靠性或效率。 | TCP, UDP                  |
|  **2**   | **网络层 (Internet)**           | 负责数据包在网络中的路由选择和转发（逻辑寻址）。             | IP (IPv4/IPv6), ICMP, ARP |
|  **1**   | **网络接口层 (Network Access)** | 负责物理传输，包括物理介质、硬件地址（MAC）和数据帧封装。    | Ethernet, Wi-Fi, PPP      |

## 网络接口层 (Network Access Layer)

这是模型的最底层，对应 OSI 模型的物理层和数据链路层。它定义了如何通过物理介质（如光纤、双绞线）发送数据。

- **功能：** 将 IP 数据报封装成**帧 (Frame)**，并通过物理网络发送。
- **硬件：** 网卡、交换机。

## 网络层 (Internet Layer)

网络层是整个 TCP/IP 协议栈的核心。它解决了数据如何从一台计算机跨越多个网络到达另一台计算机的问题。

- **功能：** **路由选择**（选择最优路径）和**寻址**（使用 IP 地址）。
- **核心协议：** **IP 协议**。它不保证传输的可靠性，只负责“尽力而为”地交付。

## 传输层 (Transport Layer)

传输层负责主机中两个进程之间的通信。

- **TCP (传输控制协议)：** 面向连接，提供可靠传输（确认、重传、流量控制）。适用于对准确性要求高的场景（如网页访问）。
- **UDP (用户数据报协议)：** 无连接，不保证可靠性，但速度快。适用于实时性要求高的场景（如视频会议、在线游戏）。

## 应用层 (Application Layer)

这是用户直接接触的一层。不同的应用程序根据需要使用不同的协议来定义数据的含义。

- **示例：** 当你浏览网页时，浏览器使用 **HTTP/HTTPS** 协议；当你查询域名对应的 IP 时，使用 **DNS** 协议。

# OSI 七层模型

OSI（Open System Interconnection）七层模型是国际标准化组织（ISO）制定的一个网络通信框架。它将网络传输的过程分为七个逻辑层，每一层都有其特定的功能和协议。

| **层级** | **层名称**     | **数据单位** | **主要功能**   | **典型协议/设备** |
| :------: | -------------- | ------------ | -------------- | ----------------- |
|    7     | **应用层**     | 数据 (Data)  | 接口服务       | HTTP, FTP, DNS    |
|    6     | **表示层**     | 数据 (Data)  | 数据转换、加密 | SSL, ASCII, JPEG  |
|    5     | **会话层**     | 数据 (Data)  | 会话管理       | RPC, SQL          |
|    4     | **传输层**     | 段 (Segment) | 端到端传输     | TCP, UDP          |
|    3     | **网络层**     | 包 (Packet)  | 路由选择       | IP, ICMP, 路由器  |
|    2     | **数据链路层** | 帧 (Frame)   | 物理寻址       | MAC, 交换机       |
|    1     | **物理层**     | 比特 (Bit)   | 物理传输       | 网线, 集线器      |

## 物理层 (Physical Layer)

这是模型的最底层，负责在物理介质上传输**比特流**（0 和 1）。

- **功能：** 定义电压、接口标准、电缆类型、传输速率等。
- **设备：** 网卡、中继器、集线器、光纤、双绞线。

## 数据链路层 (Data Link Layer)

负责在相邻节点之间建立、维持和释放链路连接，传输单位是**帧**（Frame）。

- **功能：** 物理寻址（MAC 地址）、差错校验、流量控制。
- **设备：** 二层交换机、网桥。

## 网络层 (Network Layer)

负责将数据包从源端传输到目的端，核心任务是**路由选择**和**逻辑寻址**。传输单位是**数据包**（Packet）。

- **功能：** 逻辑寻址（IP 地址）、路径选择（路由）。
- **协议/设备：** IP、ICMP；路由器、三层交换机。

## 传输层 (Transport Layer)

负责端到端（进程到进程）的可靠或不可靠传输，传输单位是**段**（Segment）。

- **功能：** 分段与重组、差错控制、流量控制。
- **协议：** **TCP**（可靠传输）、**UDP**（不可靠传输）。

## 会话层 (Session Layer)

负责建立、管理和终止应用程序之间的会话连接。

- **功能：** 身份验证、权限管理、会话检查点（确保断点续传）。

## 表示层 (Presentation Layer)

处理数据的格式化、转换、加密和解密，确保接收方能读懂发送方的信息。

- **功能：** 数据压缩、加密（SSL/TLS）、格式转换（如 JPEG 转换为位图）。

## 应用层 (Application Layer)

直接为用户的应用程序提供网络服务，是用户与网络之间的接口。

- **功能：** 提供文件传输、电子邮件、网页浏览等服务。
- **协议：** HTTP、HTTPS、FTP、SMTP、DNS。

# Port

**Port**（端口）是计算机网络中用于标识数据传输终点的一种逻辑概念，它在传输层协议（如 TCP 或 UDP）中用来区分同一 IP 地址上的不同服务或应用程序。端口可以看作是一种“门”，每个端口对应一个特定的服务，比如 Web 服务、邮件服务等。

端口号是一个 16 位的数字，范围从 0 到 65535。端口号从 0 到 1023 被称为“知名端口”或“系统端口”，通常被用于常见的服务，例如 HTTP（80 端口）、HTTPS（443 端口）、SSH（22 端口）等。从 1024 到 49151 的端口号被称为“注册端口”，用于注册的应用程序。而从 49152 到 65535 的端口号则是“动态或私有端口”，用于临时分配给客户端应用程序。

## Command

```bash
# 查看占用端口号的程序（Windows）
netstat -ano | findstr :$PORT
```

作为程序员，你主要关注计算机网络中和开发、部署、调试相关的核心概念，以下是最重要的部分：

## FAQ

### 停止占用端口

```bash
# 适用于 Windows

# 查看占用 5000 端口的进程 PID
netstat -ano | findstr :5000

# 查看 PID 为 49844 的进程具体是什么（假如上一步返回的处于监听状态的 PID 为 49844）
tasklist | findstr 49844
```

# IP

**IP**（Internet Protocol，网际协议），是计算机网络中用于**设备寻址和数据传输**的协议，每台联网设备都会被分配一个 IP 地址，以便在网络中进行通信。

## IP 地址

**IP 地址**是网络中每台设备的唯一标识，就像邮寄地址一样，用于定位和传输数据。

IPV6 用于解决 IPv4 地址短缺问题：

| **特性**     | **IPv4**                      | **IPv6**                              |
| ------------ | ----------------------------- | ------------------------------------- |
| **地址长度** | 32 位二进制 (4 字节)          | 128 位二进制 (16 字节)                |
| **地址数量** | 约 43 亿个                    | 约 $3.4 \times 10^{38}$ 个 (近乎无限) |
| **表示格式** | 点分十进制 (如 `192.168.1.1`) | 十六进制 (如 `2001:0db8:85a3...`)     |
| **安全性**   | 需额外插件 (IPSec)            | 原生支持 IPSec                        |

## IPv4

IPv4 地址是 **32 位二进制数**，通常表示为**四段十进制**（每段 8 位，范围 0-255），例如：`192.168.1.100`。

### IPv4 地址的分类

<!-- prettier-ignore -->
| 地址范围 | 类型 | 说明 |
| :---: | :---: | :---: |
| `0.0.0.0` | 特殊地址 | 代表 "所有 IP" 或默认路由 |
| `127.0.0.1` | 回环地址 | 代表本机，`ping 127.0.0.1` 测试本机网络 |
| `192.168.x.x`、`10.x.x.x`、`172.16.x.x` - `172.31.x.x` | 私有 IP | 内网 IP，不可直接访问公网 |
| `169.254.x.x` | APIPA（自动分配） | DHCP 失败时，自动分配的临时 IP |
| `224.0.0.0` - `239.255.255.255` | 组播地址 | 多播通信，如 IPTV |

### 公网 IP 和私有 IP

- **私有 IP**（内网 IP）：只能在局域网使用，不能直接访问互联网，例如：
  - `192.168.1.1`（家用路由器）
  - `10.0.0.1`（公司内部网关）
  
- **公网 IP**（外网 IP）：全球唯一，可直接访问互联网，通常由 ISP（互联网服务提供商）分配。

- **NAT 技术**：你的路由器通常拥有一个公网 IP，而你家里的所有设备都使用私有 IP。路由器通过 **NAT (网络地址转换)** 技术，让多台设备共享一个公网 IP 上网。

## IPv6

IPv6 采用 **128 位二进制数地址**，通常表示为**十六进制**，如：`2001:db8:85a3::8a2e:370:7334`。

IPv6 取消了私有 IP 和 NAT，设备可以直接分配全球唯一的 IP 地址。

## IP 相关的常见概念

### DHCP（动态主机配置协议）

- 负责自动分配 IP 地址，减少手动配置。
- 设备连接 Wi-Fi 时，通常由路由器的 DHCP 服务器分配 IP。

### NAT（网络地址转换）

- 允许私有 IP 通过一个公共 IP 访问互联网（例如家用路由器）。
- NAT 方式：

  - **SNAT**（源 NAT）：多个内网设备共享一个公网 IP。
  - **DNAT**（目的 NAT）：把公网 IP 请求映射到内网服务器（如端口映射）。

### 路由

- **静态路由**：手动配置的路由规则。
- **动态路由**：使用协议（如 BGP、OSPF）自动选择最优路径。

## FAQ

### 获取自己的 IP

```bash
curl ifconfig.me
```

# DNS

**DNS**（Domain Name System，域名系统）的主要任务是将人类可读的**域名**（Domain Name）解析为机器可读的 **IP 地址**。这个过程被称为**域名解析**。

# 域名

[**Domain**](https://developer.mozilla.org/zh-CN/docs/Learn_web_development/Howto/Web_mechanics/What_is_a_domain_name)（Domain Name，域名）是方便人类理解的地址，可通过 DNS 将域名翻译成 IP 地址。

## 域名的层级结构

域名的结构是从右向左、分层级进行管理的。

域名通过“点”（`.`）来划分不同的级别。我们以 `blog.example.com` 为例：

- **根域名 (Root Domain)：** 最顶层的节点，在技术上其实是一个看不见的点（`.`），通常被省略。
- **顶级域名 (TLD, Top-Level Domain)：** 域名的最后一部分。
  - **通用顶级域名 (gTLD)：** 如 `.com` (商业)、`.org` (组织)、`.edu` (教育)。
  - **国家代码顶级域名 (ccTLD)：** 如 `.cn` (中国)、`.jp` (日本)、`.uk` (英国)。
- **二级域名 (SLD, Second-Level Domain)：** 你在注册域名时自己想的名字，比如 `example`、`google`、`baidu`。
- **子域名 (Subdomain)：** 在二级域名前面添加的部分。比如 `www` 是最常见的子域名，`mail` 代表邮件服务，`blog` 代表博客。

# URL

[**URL**](https://developer.mozilla.org/zh-CN/docs/Learn_web_development/Howto/Web_mechanics/What_is_a_URL)（Uniform Resource Locator，统一资源定位符，俗称“网址”）是因特网中的唯一资源的地址。

![mdn-url-all](assets/mdn-url-all.png)

标准格式如下：

```
[协议类型]://[域名]:[端口号]/[文件路径]?[参数]#[片段标识符]
```

# HTTP

[**HTTP**](https://developer.mozilla.org/zh-CN/docs/Web/HTTP)（HyperText Transfer Protocol，超文本传输协议）是一个用于传输超媒体文档（例如 HTML）的应用层协议。

**HTTPS**（HyperText Transfer Protocol Secure，超文本传输安全协议）是 HTTP 协议的加密版本。它通过在 HTTP 和 TCP 之间引入一个加密层（[SSL](https://developer.mozilla.org/zh-CN/docs/Glossary/SSL) 或 [TLS](https://developer.mozilla.org/zh-CN/docs/Glossary/TLS)）来实现安全通信。

HTTP 与 HTTPS 的直观对比：

| **特性**     | **HTTP**           | **HTTPS**                         |
| ------------ | ------------------ | --------------------------------- |
| **安全性**   | 明文，不安全       | 加密，安全                        |
| **默认端口** | 80                 | 443                               |
| **证书**     | 不需要             | 需要从 CA 购买或申请              |
| **SEO 排名** | 较低               | 搜索引擎（如 Google）会优先收录   |
| **性能**     | 稍快（无握手开销） | 现代技术下几乎无感（有 TLS 优化） |

# TCP

**TCP**（Transmission Control Protocol，传输控制协议）位于传输层。它确保数据**准确无误、按顺序**地送达。

| **特性**     | **TCP**                  | **UDP**                  |
| ------------ | ------------------------ | ------------------------ |
| **连接性**   | 面向连接（先握手）       | 无连接（直接发）         |
| **可靠性**   | 极高（丢包必重传）       | 不保证（丢了就丢了）     |
| **速度**     | 较慢（因为有确认机制）   | 极快                     |
| **应用场景** | 网页浏览、文件传输、邮件 | 视频通话、直播、在线游戏 |

# Router

[**Router**](https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Express_Nodejs/routes)（路由）是一段 Express 代码，它将 HTTP 动词（`GET`、`POST`、`PUT`、`DELETE` 等）、URL 路径/模式和处理函数三者关联起来。

前后端是通过路由建立起的联系。

# 本地开发和部署

- **localhost（127.0.0.1）**：本机测试
- **Nginx/Apache 反向代理**：用于负载均衡、静态资源服务
- **Docker 网络模式**：bridge, host, overlay
- **Kubernetes（K8s）网络**：Pod 间通信、Service 发现

# 网络调试工具

- `ping`：测试连通性
- `curl` / `Postman`：API 调试
- `netstat` / `ss`：查看端口占用
- `tcpdump` / `Wireshark`：抓包分析
- `dig` / `nslookup`：DNS 解析查询
